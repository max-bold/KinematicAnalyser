from serial import Serial

# from chardet import detect as chdetect

port = Serial("COM9")

comcounter: int = 0

# def writehello(ser:Serial):
#     ser.write(b'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\n')

# def writecom(com:str, param:str='')->int:
#     w:str = f'N{comcounter} {com} {param}'.strip()
#     print([w])
#     return
while True:
    if port.readable:
        raw = port.readline()
        line = raw.decode("ASCII")
        lnum = line[0 : line.find(" ")]
        lcom = line[line.find(" ") + 1 : line.find("*")]
        lchsum = line[line.find("*") + 1 :]
        print([raw, lnum, lcom])
        if "M105" in lcom:
            port.write("T:200\r".encode("ascii"))
            port.write(f"ok\r".encode("ascii"))
            # print('t sent')

        # elif 'G1' in lcom:
        #     port.write(f'{lnum} OK\r\n'.encode('ascii'))

        elif (
            raw
            == b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\n"
        ):
            port.write(
                b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\n"
            )
        elif lcom == "M114":
            port.write("X:800.00 Y:20.00 Z:612.000 E:2000.0000\rok\r".encode("ascii"))
        else:
            port.write(f"ok\r".encode("ascii"))

# writecom('M105')
# writecom('G1 Z200')
